<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500" rel="stylesheet">
    <link rel="stylesheet" href="./dist/css/styles.css">
    <title>Delta</title>
</head>
<body>
    <div id="app">
    <div id="notifyContainer"></div>

    <div class="statusBar">
        <h1 class="title-big no-select">
            <span>Project: </span>Delta<span class="beta-badge" v-if="isBeta"></span>
        </h1>

        <div class="profileInfo">
            <i class="btnRefresh fas fa-sync-alt" title="Ververs gegevens" @click="setRefreshCooldown()" onclick="refreshData()"></i>
            <h1 class="username">{{ profile.username }}</h1>
            <img class="profileIcon" :src="profile.imgUrl" title="Instellingen en profiel">
        </div>
    </div>
    
    <div class="container">
        <div class="card" id="prestaties">
            <h1>Prestaties</h1>
            <div>
                <div v-if="magister.getLastGrades().length == 0" class="no-info">
                    <i class="fas fa-chart-line"></i>
                    <p>Prestaties komen hier te staan als je meer cijfers haalt.</p>
                </div>

                <canvas v-show="magister.getLastGrades().length > 0" id="perfChart" height="280"></canvas>
            </div>
        </div>

        <div class="card" id="agenda">
            <h1>Agenda <span>voor {{ agendaDate }}</span></h1>
            <div :class="{ bigList: magister.appointments.length > 0 }">
                <div v-if="magister.appointments.length == 0" class="no-info">
                    <i class="far fa-calendar"></i>
                    <p>Geen afspraken voor morgen.</p>
                </div>

                <div v-for="i in magister.appointments" :class="{ scrapped: i.scrapped() }" class="bigListItem">
                    <div class="itemContainer calendarItem">{{ i.beginBySchoolHour() }}</div>
                    <div v-if="i.beginBySchoolHour() != i.endBySchoolHour()" class="itemContainer calendarItem">{{ i.endBySchoolHour() }}</div>
                    <div class="itemDesc">
                        <p>
                            {{ i.classes()[0] }}
                            <span> {{ formatTime(i.begin()) }} - {{ formatTime(i.end()) }} </span>
                            <span class="location">{{ i.location() }}</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card" id="huiswerk">
            <h1>Huiswerk <span>voor {{ agendaDate }}</span></h1>
            <div class="checkContainer">
                <input v-model="showDoneHomework" name="huiswerkDone" type="checkbox">
                <span>Toon voltooide</span>
            </div>

            <div>
                <div v-if="(magister.filterHomework(false).length == 0 && !showDoneHomework) ||
                    magister.grades.length == 0" class="no-info">
                    <i class="far fa-smile-wink"></i>
                    <p>Je hebt geen huiswerk voor {{ agendaDate }}.</p>
                </div>

                <div v-for="i in magister.filterHomework(false)" class="smallCard">
                    <div class="todo">
                        <div class="itemContainer homeworkItem">
                            <i class="far fa-bookmark"></i>
                        </div>


                        <p>{{ i.classes()[0] }}</p>
                        <p>{{ trimContent(i.content()) }}</p>
                    </div>

                    <div class="btnPanel">
                        <div class="cardButton finishHomework"
                            @click="toggleHomeworkState(i)"
                            title="Huiswerk afronden"><i class="far fa-check-circle"></i></div>

                        <div class="cardButton infoDetails"
                            title="Meer informatie"><i class="fas fa-info"></i></div>
                    </div>
                </div>

                <div v-for="i in magister.filterHomework(true)" v-if="showDoneHomework" class="smallCard">
                    <div class="done">
                        <div class="itemContainer homeworkItem">
                            <i class="fas fa-check"></i>
                        </div>

                        <p>{{ i.classes()[0] }}</p>
                        <p>{{ trimContent(i.content()) }}</p>
                    </div>

                    <div class="btnPanel">
                        <div class="cardButton finishHomework"
                            @click="toggleHomeworkState(i)"
                            title="Huiswerk markeren als onafgerond"><i class="far fa-times-circle"></i></div>

                        <div class="cardButton infoDetails"
                            title="Meer informatie"><i class="fas fa-info"></i></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card" id="berichten">
            <h1>Berichten</h1>
            <div class="checkContainer">
                <input v-model="showReadMail" name="readMail" type="checkbox">
                <span>Toon gelezen</span>
            </div>

            <div>
                <div v-if="(magister.filterMessages(false).length == 0 && !showReadMail) ||
                    magister.messages.length == 0" class="no-info">
                    <i class="far fa-envelope-open"></i>
                    <p>Geen nieuwe berichten.</p>
                </div>

                <div v-for="i in magister.filterMessages(false)" class="smallCard">
                    <div class="itemContainer messageItem unread">
                        <i class="far fa-envelope"></i>
                    </div>

                    <div class="itemDesc">
                        <p>
                            {{ i.sender().fullName() }} -
                            <span>{{ i.subject() }}</span>
                        </p>
                        <p>{{ trimContent(i.body()) }}</p>
                        <div v-if="i.attachments().length > 0" class="attachContainer">
                            <div v-for="file in i.attachments()"
                                @click="magister.downloadAttachment(file)"
                                :title="getAttachmentTitle(file)" class="attachment">
                                <i :class="getFileIcon(file.name())" class="attachIcon far"></i>
                                <p>{{ trimContent(file.name(), 25) }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-for="i in magister.filterMessages(true)" v-if="showReadMail" class="smallCard">
                    <div class="itemContainer messageItem">
                        <i class="far fa-envelope-open"></i>
                    </div>

                    <div class="itemDesc">
                        <p>
                            {{ i.sender().fullName() }} -
                            <span>{{ i.subject() }}</span>
                        </p>
                        <p>{{ trimContent(i.body()) }}</p>
                        <div v-if="i.attachments().length > 0" class="attachContainer">
                            <div v-for="file in i.attachments()"
                                @click="magister.downloadAttachment(file)"
                                :title="getAttachmentTitle(file)"
                                class="attachment">
                                <i :class="getFileIcon(file.name())" class="attachIcon far"></i>
                                <p>{{ trimContent(file.name(), 25) }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card" id="cijfers">
            <h1>Laatste cijfers</h1>
            <div>
                <div v-if="magister.getLastGrades().length == 0" class="no-info">
                    <i class="fas fa-chart-pie"></i>
                    <p>Je hebt nog geen cijfers.</p>
                </div>

                <div v-for="i in magister.getLastGrades()" class="smallCard">
                    <div>
                        <div
                            :class="{ failed: magister.isFailed(i.grade()), wellDone: magister.isWellDone(i.grade()) }"
                            class="itemContainer gradeItem">
                            
                            <p>{{ i.grade() }}</p>
                        </div>

                        <p>{{ i.class().description }} <p class="detail">{{ i.weight().toFixed(1) }}x</p></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card" id="toetsen">
            <h1>Toetsen <span>komende twee weken</span></h1>
            <div>
                <div v-if="magister.tests.length == 0" class="no-info">
                    <i class="fas fa-pen-fancy"></i>
                    <p>Je hebt geen toetsen voor de komende week.</p>
                </div>

                <div v-for="i in magister.tests" class="smallCard">
                    <div class="itemContainer testItem">
                        <p v-if="i.infoTypeString() == 'test'">PW</p>
                        <p v-if="i.infoTypeString() == 'quiz'">SO</p>
                    </div>

                    <p>{{ i.classes()[0] }}</p>
                    <p class="detail">
                        {{ formatDateHuman(i.begin()) }}
                        <span :class="{ warn: getDateDifference(new Date(), i.begin()) < 3 }"
                            class="right">
                            <i class="far fa-clock"></i>
                            over {{ getDateDifference(new Date(), i.begin(), true) }} dag{{ getDateDifference(new Date(), i.begin(), true) > 1 ? "en" : "" }}</span>
                    </p>
                    <p>{{ trimContent(i.content()) }}</p>
                </div>
            </div>
        </div>

        <div class="card" id="afwezigheid">
            <h1>Afwezigheid</h1>
            <div>
                <div class="no-info">
                    <i class="far fa-frown"></i>
                    <p>Deze functie is helaas nog niet beschikbaar.</p>
                </div>
            </div>
        </div>

        <div class="card" id="inzichten">
            <h1>Inzichten</h1>
            <div>
                <div v-if="magister.insights.length == 0" class="no-info">
                    <i class="fas fa-search"></i>
                    <p>Inzichten worden aangevuld in de loop van het schooljaar.</p>
                </div>

                <div v-for="i in magister.insights" class="smallCard">
                    <div
                        class="itemContainer insightItem"
                        :style="{ background: i.colors.bg, color: i.colors.fg }">

                        <i :class="[i.icon, {'far fa-lightbulb': i.icon == null}]" ></i>
                    </div>

                    <p>{{ i.name }}</p>
                </div>
            </div>
        </div>

        <div class="card" id="opdrachten">
            <h1>Opdrachten</h1>
            <div>
                <div v-if="magister.assignments.length == 0" class="no-info">
                    <i class="fas fa-book"></i>
                    <p>Geen openstaande opdrachten.</p>
                </div>

                <div v-for="i in magister.assignments" class="smallCard">
                    <div class="todo">
                        <div class="itemContainer homeworkItem">
                            <i class="far fa-edit"></i>
                        </div>
                        <p>{{ i.name() }}</p>
                        <p>{{ trimContent(i.description()) }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </div>

    <script src="./js/notify.js"></script>
    <script src="./js/index.js"></script>
</body>
</html>
